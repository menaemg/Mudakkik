; Supervisor configuration for Mudakkik Queue Workers
; Copy to: /etc/supervisor/conf.d/mudakkik.conf
;
; Queue Jobs processed by workers:
; - ProcessStripeWebhook: Stripe webhook handling
; - SubscriptionCreated, PaymentSuccessful, PaymentFailed: User notifications
; - StalePaymentAlert: Admin alerts
;
; Scheduled Jobs (handled by cron, not supervisor):
; - ReconcilePendingPayments: Every 10 minutes
; - HandleExpiredSubscriptions: Daily at midnight

[program:mudakkik-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/mudakkik/current/artisan queue:work redis --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=ubuntu
numprocs=2
redirect_stderr=true
stdout_logfile=/var/www/mudakkik/shared/storage/logs/worker.log
stopwaitsecs=3600
